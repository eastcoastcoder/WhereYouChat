{"version":3,"sources":["resources/leaflet.draw/edit/handler/Edit.SimpleShape.js"],"names":["L","Edit","SimpleShape","Handler","extend","options","moveIcon","DivIcon","iconSize","Point","className","resizeIcon","touchMoveIcon","touchResizeIcon","initialize","shape","Browser","touch","_shape","Util","setOptions","addHooks","_map","setStyle","editing","_markerGroup","_initMarkers","addLayer","removeHooks","original","_unbindMarker","_moveMarker","i","l","_resizeMarkers","length","removeLayer","updateMarkers","clearLayers","LayerGroup","_createMoveMarker","_createResizeMarker","_createMarker","latlng","icon","marker","Marker","Touch","draggable","zIndexOffset","_bindMarker","on","_onMarkerDragStart","_onMarkerDrag","_onMarkerDragEnd","_onTouchStart","_onTouchMove","_onTouchEnd","off","e","target","setOpacity","fire","_fireEdit","edited","getLatLng","_move","_resize","redraw","prototype","call","_getCorners","corners","currentCornerIndex","_cornerIndex","_oppositeCorner","_toggleCornerMarkers","layerPoint","mouseEventToLayerPoint","originalEvent","touches","layerPointToLatLng"],"mappings":"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","file":"Edit.SimpleShape.2e043ee2.map","sourceRoot":"..","sourcesContent":["L.Edit = L.Edit || {};\n/**\n * @class L.Edit.SimpleShape\n * @aka Edit.SimpleShape\n */\nL.Edit.SimpleShape = L.Handler.extend({\n\toptions: {\n\t\tmoveIcon: new L.DivIcon({\n\t\t\ticonSize: new L.Point(8, 8),\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon leaflet-edit-move'\n\t\t}),\n\t\tresizeIcon: new L.DivIcon({\n\t\t\ticonSize: new L.Point(8, 8),\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon leaflet-edit-resize'\n\t\t}),\n\t\ttouchMoveIcon: new L.DivIcon({\n\t\t\ticonSize: new L.Point(20, 20),\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon leaflet-edit-move leaflet-touch-icon'\n\t\t}),\n\t\ttouchResizeIcon: new L.DivIcon({\n\t\t\ticonSize: new L.Point(20, 20),\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon leaflet-edit-resize leaflet-touch-icon'\n\t\t}),\n\t},\n\n\t// @method intialize(): void\n\tinitialize: function (shape, options) {\n\t\t// if touch, switch to touch icon\n\t\tif (L.Browser.touch) {\n\t\t\tthis.options.moveIcon = this.options.touchMoveIcon;\n\t\t\tthis.options.resizeIcon = this.options.touchResizeIcon;\n\t\t}\n\n\t\tthis._shape = shape;\n\t\tL.Util.setOptions(this, options);\n\t},\n\n\t// @method addHooks(): void\n\t// Add listener hooks to this handler\n\taddHooks: function () {\n\t\tvar shape = this._shape;\n\t\tif (this._shape._map) {\n\t\t\tthis._map = this._shape._map;\n\t\t\tshape.setStyle(shape.options.editing);\n\n\t\t\tif (shape._map) {\n\t\t\t\tthis._map = shape._map;\n\t\t\t\tif (!this._markerGroup) {\n\t\t\t\t\tthis._initMarkers();\n\t\t\t\t}\n\t\t\t\tthis._map.addLayer(this._markerGroup);\n\t\t\t}\n\t\t}\n\t},\n\n\t// @method removeHooks(): void\n\t// Remove listener hooks from this handler\n\tremoveHooks: function () {\n\t\tvar shape = this._shape;\n\n\t\tshape.setStyle(shape.options.original);\n\n\t\tif (shape._map) {\n\t\t\tthis._unbindMarker(this._moveMarker);\n\n\t\t\tfor (var i = 0, l = this._resizeMarkers.length; i < l; i++) {\n\t\t\t\tthis._unbindMarker(this._resizeMarkers[i]);\n\t\t\t}\n\t\t\tthis._resizeMarkers = null;\n\n\t\t\tthis._map.removeLayer(this._markerGroup);\n\t\t\tdelete this._markerGroup;\n\t\t}\n\n\t\tthis._map = null;\n\t},\n\n\t// @method updateMarkers(): void\n\t// Remove the edit markers from this layer\n\tupdateMarkers: function () {\n\t\tthis._markerGroup.clearLayers();\n\t\tthis._initMarkers();\n\t},\n\n\t_initMarkers: function () {\n\t\tif (!this._markerGroup) {\n\t\t\tthis._markerGroup = new L.LayerGroup();\n\t\t}\n\n\t\t// Create center marker\n\t\tthis._createMoveMarker();\n\n\t\t// Create edge marker\n\t\tthis._createResizeMarker();\n\t},\n\n\t_createMoveMarker: function () {\n\t\t// Children override\n\t},\n\n\t_createResizeMarker: function () {\n\t\t// Children override\n\t},\n\n\t_createMarker: function (latlng, icon) {\n\t\t// Extending L.Marker in TouchEvents.js to include touch.\n\t\tvar marker = new L.Marker.Touch(latlng, {\n\t\t\tdraggable: true,\n\t\t\ticon: icon,\n\t\t\tzIndexOffset: 10\n\t\t});\n\n\t\tthis._bindMarker(marker);\n\n\t\tthis._markerGroup.addLayer(marker);\n\n\t\treturn marker;\n\t},\n\n\t_bindMarker: function (marker) {\n\t\tmarker\n\t\t\t.on('dragstart', this._onMarkerDragStart, this)\n\t\t\t.on('drag', this._onMarkerDrag, this)\n\t\t\t.on('dragend', this._onMarkerDragEnd, this)\n\t\t\t.on('touchstart', this._onTouchStart, this)\n\t\t\t.on('touchmove', this._onTouchMove, this)\n\t\t\t.on('MSPointerMove', this._onTouchMove, this)\n\t\t\t.on('touchend', this._onTouchEnd, this)\n\t\t\t.on('MSPointerUp', this._onTouchEnd, this);\n\t},\n\n\t_unbindMarker: function (marker) {\n\t\tmarker\n\t\t\t.off('dragstart', this._onMarkerDragStart, this)\n\t\t\t.off('drag', this._onMarkerDrag, this)\n\t\t\t.off('dragend', this._onMarkerDragEnd, this)\n\t\t\t.off('touchstart', this._onTouchStart, this)\n\t\t\t.off('touchmove', this._onTouchMove, this)\n\t\t\t.off('MSPointerMove', this._onTouchMove, this)\n\t\t\t.off('touchend', this._onTouchEnd, this)\n\t\t\t.off('MSPointerUp', this._onTouchEnd, this);\n\t},\n\n\t_onMarkerDragStart: function (e) {\n\t\tvar marker = e.target;\n\t\tmarker.setOpacity(0);\n\n\t\tthis._shape.fire('editstart');\n\t},\n\n\t_fireEdit: function () {\n\t\tthis._shape.edited = true;\n\t\tthis._shape.fire('edit');\n\t},\n\n\t_onMarkerDrag: function (e) {\n\t\tvar marker = e.target,\n\t\t\tlatlng = marker.getLatLng();\n\n\t\tif (marker === this._moveMarker) {\n\t\t\tthis._move(latlng);\n\t\t} else {\n\t\t\tthis._resize(latlng);\n\t\t}\n\n\t\tthis._shape.redraw();\n\t\tthis._shape.fire('editdrag');\n\t},\n\n\t_onMarkerDragEnd: function (e) {\n\t\tvar marker = e.target;\n\t\tmarker.setOpacity(1);\n\n\t\tthis._fireEdit();\n\t},\n\n\t_onTouchStart: function (e) {\n\t\tL.Edit.SimpleShape.prototype._onMarkerDragStart.call(this, e);\n\n\t\tif (typeof(this._getCorners) === 'function') {\n\t\t\t// Save a reference to the opposite point\n\t\t\tvar corners = this._getCorners(),\n\t\t\t\tmarker = e.target,\n\t\t\t\tcurrentCornerIndex = marker._cornerIndex;\n\n\t\t\tmarker.setOpacity(0);\n\n\t\t\t// Copyed from Edit.Rectangle.js line 23 _onMarkerDragStart()\n\t\t\t// Latlng is null otherwise.\n\t\t\tthis._oppositeCorner = corners[(currentCornerIndex + 2) % 4];\n\t\t\tthis._toggleCornerMarkers(0, currentCornerIndex);\n\t\t}\n\n\t\tthis._shape.fire('editstart');\n\t},\n\n\t_onTouchMove: function (e) {\n\t\tvar layerPoint = this._map.mouseEventToLayerPoint(e.originalEvent.touches[0]),\n\t\t\tlatlng = this._map.layerPointToLatLng(layerPoint),\n\t\t\tmarker = e.target;\n\n\t\tif (marker === this._moveMarker) {\n\t\t\tthis._move(latlng);\n\t\t} else {\n\t\t\tthis._resize(latlng);\n\t\t}\n\n\t\tthis._shape.redraw();\n\n\t\t// prevent touchcancel in IOS\n\t\t// e.preventDefault();\n\t\treturn false;\n\t},\n\n\t_onTouchEnd: function (e) {\n\t\tvar marker = e.target;\n\t\tmarker.setOpacity(1);\n\t\tthis.updateMarkers();\n\t\tthis._fireEdit();\n\t},\n\n\t_move: function () {\n\t\t// Children override\n\t},\n\n\t_resize: function () {\n\t\t// Children override\n\t}\n});\n"]}