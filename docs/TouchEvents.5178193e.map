{"version":3,"sources":["resources/leaflet.draw/ext/TouchEvents.js"],"names":["L","Map","mergeOptions","touchExtend","TouchExtend","Handler","extend","initialize","map","_map","_container","_pane","_panes","overlayPane","addHooks","DomEvent","on","_onTouchStart","_onTouchEnd","_onTouchMove","_detectIE","_onTouchCancel","_onTouchLeave","removeHooks","off","_touchEvent","e","type","touchEvent","touches","length","pointerType","_filterClick","containerPoint","mouseEventToContainerPoint","layerPoint","mouseEventToLayerPoint","latlng","layerPointToLatLng","fire","pageX","pageY","originalEvent","timeStamp","elapsed","_lastClick","target","_simulatedClick","_simulated","stop","_loaded","ua","window","navigator","userAgent","msie","indexOf","parseInt","substring","trident","rv","edge","addInitHook","Marker","Touch","_initInteraction","addInteractiveTarget","prototype","apply","_initInteractionLegacy","options","clickable","icon","_icon","events","concat","DomUtil","addClass","_onMouseClick","_onKeyPress","i","_fireMouseEvent","MarkerDrag","dragging","draggable","enable"],"mappings":"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","file":"TouchEvents.5178193e.map","sourceRoot":"..","sourcesContent":["L.Map.mergeOptions({\n\ttouchExtend: true\n});\n\n/**\n * @class L.Map.TouchExtend\n * @aka TouchExtend\n */\nL.Map.TouchExtend = L.Handler.extend({\n\n\t// @method initialize(): void\n\t// Sets TouchExtend private accessor variables\n\tinitialize: function (map) {\n\t\tthis._map = map;\n\t\tthis._container = map._container;\n\t\tthis._pane = map._panes.overlayPane;\n\t},\n\n\t// @method addHooks(): void\n\t// Adds dom listener events to the map container\n\taddHooks: function () {\n\t\tL.DomEvent.on(this._container, 'touchstart', this._onTouchStart, this);\n\t\tL.DomEvent.on(this._container, 'touchend', this._onTouchEnd, this);\n\t\tL.DomEvent.on(this._container, 'touchmove', this._onTouchMove, this);\n\t\tif (this._detectIE()) {\n\t\t\tL.DomEvent.on(this._container, 'MSPointerDown', this._onTouchStart, this);\n\t\t\tL.DomEvent.on(this._container, 'MSPointerUp', this._onTouchEnd, this);\n\t\t\tL.DomEvent.on(this._container, 'MSPointerMove', this._onTouchMove, this);\n\t\t\tL.DomEvent.on(this._container, 'MSPointerCancel', this._onTouchCancel, this);\n\n\t\t} else {\n\t\t\tL.DomEvent.on(this._container, 'touchcancel', this._onTouchCancel, this);\n\t\t\tL.DomEvent.on(this._container, 'touchleave', this._onTouchLeave, this);\n\t\t}\n\t},\n\n\t// @method removeHooks(): void\n\t// Removes dom listener events from the map container\n\tremoveHooks: function () {\n\t\tL.DomEvent.off(this._container, 'touchstart', this._onTouchStart);\n\t\tL.DomEvent.off(this._container, 'touchend', this._onTouchEnd);\n\t\tL.DomEvent.off(this._container, 'touchmove', this._onTouchMove);\n\t\tif (this._detectIE()) {\n\t\t\tL.DomEvent.off(this._container, 'MSPointerDowm', this._onTouchStart);\n\t\t\tL.DomEvent.off(this._container, 'MSPointerUp', this._onTouchEnd);\n\t\t\tL.DomEvent.off(this._container, 'MSPointerMove', this._onTouchMove);\n\t\t\tL.DomEvent.off(this._container, 'MSPointerCancel', this._onTouchCancel);\n\t\t} else {\n\t\t\tL.DomEvent.off(this._container, 'touchcancel', this._onTouchCancel);\n\t\t\tL.DomEvent.off(this._container, 'touchleave', this._onTouchLeave);\n\t\t}\n\t},\n\n\t_touchEvent: function (e, type) {\n\t\t// #TODO: fix the pageX error that is do a bug in Android where a single touch triggers two click events\n\t\t// _filterClick is what leaflet uses as a workaround.\n\t\t// This is a problem with more things than just android. Another problem is touchEnd has no touches in\n\t\t// its touch list.\n\t\tvar touchEvent = {};\n\t\tif (typeof e.touches !== 'undefined') {\n\t\t\tif (!e.touches.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttouchEvent = e.touches[0];\n\t\t} else if (e.pointerType === 'touch') {\n\t\t\ttouchEvent = e;\n\t\t\tif (!this._filterClick(e)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tvar containerPoint = this._map.mouseEventToContainerPoint(touchEvent),\n\t\t\tlayerPoint = this._map.mouseEventToLayerPoint(touchEvent),\n\t\t\tlatlng = this._map.layerPointToLatLng(layerPoint);\n\n\t\tthis._map.fire(type, {\n\t\t\tlatlng: latlng,\n\t\t\tlayerPoint: layerPoint,\n\t\t\tcontainerPoint: containerPoint,\n\t\t\tpageX: touchEvent.pageX,\n\t\t\tpageY: touchEvent.pageY,\n\t\t\toriginalEvent: e\n\t\t});\n\t},\n\n\t/** Borrowed from Leaflet and modified for bool ops **/\n\t_filterClick: function (e) {\n\t\tvar timeStamp = (e.timeStamp || e.originalEvent.timeStamp),\n\t\t\telapsed = L.DomEvent._lastClick && (timeStamp - L.DomEvent._lastClick);\n\n\t\t// are they closer together than 500ms yet more than 100ms?\n\t\t// Android typically triggers them ~300ms apart while multiple listeners\n\t\t// on the same event should be triggered far faster;\n\t\t// or check if click is simulated on the element, and if it is, reject any non-simulated events\n\t\tif ((elapsed && elapsed > 100 && elapsed < 500) || (e.target._simulatedClick && !e._simulated)) {\n\t\t\tL.DomEvent.stop(e);\n\t\t\treturn false;\n\t\t}\n\t\tL.DomEvent._lastClick = timeStamp;\n\t\treturn true;\n\t},\n\n\t_onTouchStart: function (e) {\n\t\tif (!this._map._loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar type = 'touchstart';\n\t\tthis._touchEvent(e, type);\n\n\t},\n\n\t_onTouchEnd: function (e) {\n\t\tif (!this._map._loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar type = 'touchend';\n\t\tthis._touchEvent(e, type);\n\t},\n\n\t_onTouchCancel: function (e) {\n\t\tif (!this._map._loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar type = 'touchcancel';\n\t\tif (this._detectIE()) {\n\t\t\ttype = 'pointercancel';\n\t\t}\n\t\tthis._touchEvent(e, type);\n\t},\n\n\t_onTouchLeave: function (e) {\n\t\tif (!this._map._loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar type = 'touchleave';\n\t\tthis._touchEvent(e, type);\n\t},\n\n\t_onTouchMove: function (e) {\n\t\tif (!this._map._loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar type = 'touchmove';\n\t\tthis._touchEvent(e, type);\n\t},\n\n\t_detectIE: function () {\n\t\tvar ua = window.navigator.userAgent;\n\n\t\tvar msie = ua.indexOf('MSIE ');\n\t\tif (msie > 0) {\n\t\t\t// IE 10 or older => return version number\n\t\t\treturn parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\n\t\t}\n\n\t\tvar trident = ua.indexOf('Trident/');\n\t\tif (trident > 0) {\n\t\t\t// IE 11 => return version number\n\t\t\tvar rv = ua.indexOf('rv:');\n\t\t\treturn parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\n\t\t}\n\n\t\tvar edge = ua.indexOf('Edge/');\n\t\tif (edge > 0) {\n\t\t\t// IE 12 => return version number\n\t\t\treturn parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\n\t\t}\n\n\t\t// other browser\n\t\treturn false;\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'touchExtend', L.Map.TouchExtend);\n\n\n/**\n * @class L.Marker.Touch\n * @aka Marker.Touch\n *\n * This isn't full Touch support. This is just to get markers to also support dom touch events after creation\n * #TODO: find a better way of getting markers to support touch.\n */\nL.Marker.Touch = L.Marker.extend({\n\n\t_initInteraction: function () {\n\t\tif (!this.addInteractiveTarget) {\n\t\t\t// 0.7.x support\n\t\t\treturn this._initInteractionLegacy();\n\t\t}\n\t\t// TODO this may need be updated to re-add touch events for 1.0+\n\t\treturn L.Marker.prototype._initInteraction.apply(this);\n\t},\n\n\t// This is an exact copy of https://github.com/Leaflet/Leaflet/blob/v0.7/src/layer/marker/Marker.js\n\t// with the addition of the touch events\n\t_initInteractionLegacy: function () {\n\n\t\tif (!this.options.clickable) {\n\t\t\treturn;\n\t\t}\n\n\t\t// TODO refactor into something shared with Map/Path/etc. to DRY it up\n\n\t\tvar icon = this._icon,\n\t\t\tevents = ['dblclick',\n\t\t\t\t'mousedown',\n\t\t\t\t'mouseover',\n\t\t\t\t'mouseout',\n\t\t\t\t'contextmenu',\n\t\t\t\t'touchstart',\n\t\t\t\t'touchend',\n\t\t\t\t'touchmove'];\n\t\tif (this._detectIE) {\n\t\t\tevents.concat(['MSPointerDown',\n\t\t\t\t'MSPointerUp',\n\t\t\t\t'MSPointerMove',\n\t\t\t\t'MSPointerCancel']);\n\t\t} else {\n\t\t\tevents.concat(['touchcancel']);\n\t\t}\n\n\t\tL.DomUtil.addClass(icon, 'leaflet-clickable');\n\t\tL.DomEvent.on(icon, 'click', this._onMouseClick, this);\n\t\tL.DomEvent.on(icon, 'keypress', this._onKeyPress, this);\n\n\t\tfor (var i = 0; i < events.length; i++) {\n\t\t\tL.DomEvent.on(icon, events[i], this._fireMouseEvent, this);\n\t\t}\n\n\t\tif (L.Handler.MarkerDrag) {\n\t\t\tthis.dragging = new L.Handler.MarkerDrag(this);\n\n\t\t\tif (this.options.draggable) {\n\t\t\t\tthis.dragging.enable();\n\t\t\t}\n\t\t}\n\t},\n\n\t_detectIE: function () {\n\t\tvar ua = window.navigator.userAgent;\n\n\t\tvar msie = ua.indexOf('MSIE ');\n\t\tif (msie > 0) {\n\t\t\t// IE 10 or older => return version number\n\t\t\treturn parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\n\t\t}\n\n\t\tvar trident = ua.indexOf('Trident/');\n\t\tif (trident > 0) {\n\t\t\t// IE 11 => return version number\n\t\t\tvar rv = ua.indexOf('rv:');\n\t\t\treturn parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\n\t\t}\n\n\t\tvar edge = ua.indexOf('Edge/');\n\t\tif (edge > 0) {\n\t\t\t// IE 12 => return version number\n\t\t\treturn parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\n\t\t}\n\n\t\t// other browser\n\t\treturn false;\n\t}\n});\n"]}