{"version":3,"sources":["resources/leaflet.draw/edit/handler/Edit.Poly.js"],"names":["L","Edit","Poly","Handler","extend","initialize","poly","latlngs","_latlngs","_holes","concat","_poly","on","_updateLatLngs","_defaultShape","Polyline","_flat","_eachVertexHandler","callback","i","_verticesHandlers","length","addHooks","_initHandlers","handler","removeHooks","updateMarkers","push","PolyVerticesEdit","options","e","layer","icon","DivIcon","iconSize","Point","className","touchIcon","drawError","color","timeout","Browser","touch","Util","setOptions","path","_path","Polygon","fill","editing","original","split","forEach","DomUtil","removeClass","addClass","setStyle","_map","_markerGroup","_initMarkers","addLayer","removeLayer","_markers","clearLayers","LayerGroup","j","len","marker","markerLeft","markerRight","_createMarker","_onMarkerClick","_onContextMenu","_createMiddleMarker","_updatePrevNext","latlng","index","Marker","Touch","draggable","_origLatLng","_index","_onMarkerDragStart","_onMarkerDrag","_fireEdit","_onTouchMove","fire","_spliceLatLngs","removed","splice","apply","arguments","_convertLatLngs","redraw","_removeMarker","_updateIndexes","off","edited","Draw","Event","EDITVERTEX","layers","target","_latlng","_middleLeft","setLatLng","_getMiddleLatLng","_prev","_middleRight","_next","tooltip","_editTooltip","allowIntersection","intersects","originalColor","version","indexOf","dragging","_draggable","_onUp","updateContent","text","drawLocal","draw","handlers","polyline","error","setTimeout","edit","subtext","_bounds","_southWest","latLng","Infinity","_northEast","getLatLngs","minPoints","MARKERCONTEXT","DomEvent","stopPropagation","layerPoint","mouseEventToLayerPoint","originalEvent","touches","layerPointToLatLng","delta","eachLayer","marker1","marker2","onClick","onDragStart","onDragEnd","setOpacity","lat","getLatLng","lng","call","map","p1","project","p2","unproject","_add","_divideBy","addInitHook","editable","enable","enabled"],"mappings":"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","file":"Edit.Poly.d38e9453.map","sourceRoot":"..","sourcesContent":["L.Edit = L.Edit || {};\n\n/**\n * @class L.Edit.Polyline\n * @aka L.Edit.Poly\n * @aka Edit.Poly\n */\nL.Edit.Poly = L.Handler.extend({\n\t// @method initialize(): void\n\tinitialize: function (poly) {\n\n\t\tthis.latlngs = [poly._latlngs];\n\t\tif (poly._holes) {\n\t\t\tthis.latlngs = this.latlngs.concat(poly._holes);\n\t\t}\n\n\t\tthis._poly = poly;\n\n\t\tthis._poly.on('revert-edited', this._updateLatLngs, this);\n\t},\n\n\t// Compatibility method to normalize Poly* objects\n\t// between 0.7.x and 1.0+\n\t_defaultShape: function () {\n\t\tif (!L.Polyline._flat) {\n\t\t\treturn this._poly._latlngs;\n\t\t}\n\t\treturn L.Polyline._flat(this._poly._latlngs) ? this._poly._latlngs : this._poly._latlngs[0];\n\t},\n\n\t_eachVertexHandler: function (callback) {\n\t\tfor (var i = 0; i < this._verticesHandlers.length; i++) {\n\t\t\tcallback(this._verticesHandlers[i]);\n\t\t}\n\t},\n\n\t// @method addHooks(): void\n\t// Add listener hooks to this handler\n\taddHooks: function () {\n\t\tthis._initHandlers();\n\t\tthis._eachVertexHandler(function (handler) {\n\t\t\thandler.addHooks();\n\t\t});\n\t},\n\n\t// @method removeHooks(): void\n\t// Remove listener hooks from this handler\n\tremoveHooks: function () {\n\t\tthis._eachVertexHandler(function (handler) {\n\t\t\thandler.removeHooks();\n\t\t});\n\t},\n\n\t// @method updateMarkers(): void\n\t// Fire an update for each vertex handler\n\tupdateMarkers: function () {\n\t\tthis._eachVertexHandler(function (handler) {\n\t\t\thandler.updateMarkers();\n\t\t});\n\t},\n\n\t_initHandlers: function () {\n\t\tthis._verticesHandlers = [];\n\t\tfor (var i = 0; i < this.latlngs.length; i++) {\n\t\t\tthis._verticesHandlers.push(new L.Edit.PolyVerticesEdit(this._poly, this.latlngs[i], this._poly.options.poly));\n\t\t}\n\t},\n\n\t_updateLatLngs: function (e) {\n\t\tthis.latlngs = [e.layer._latlngs];\n\t\tif (e.layer._holes) {\n\t\t\tthis.latlngs = this.latlngs.concat(e.layer._holes);\n\t\t}\n\t}\n\n});\n\n/**\n * @class L.Edit.PolyVerticesEdit\n * @aka Edit.PolyVerticesEdit\n */\nL.Edit.PolyVerticesEdit = L.Handler.extend({\n\toptions: {\n\t\ticon: new L.DivIcon({\n\t\t\ticonSize: new L.Point(8, 8),\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon'\n\t\t}),\n\t\ttouchIcon: new L.DivIcon({\n\t\t\ticonSize: new L.Point(20, 20),\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon leaflet-touch-icon'\n\t\t}),\n\t\tdrawError: {\n\t\t\tcolor: '#b00b00',\n\t\t\ttimeout: 1000\n\t\t}\n\n\n\t},\n\n\t// @method intialize(): void\n\tinitialize: function (poly, latlngs, options) {\n\t\t// if touch, switch to touch icon\n\t\tif (L.Browser.touch) {\n\t\t\tthis.options.icon = this.options.touchIcon;\n\t\t}\n\t\tthis._poly = poly;\n\n\t\tif (options && options.drawError) {\n\t\t\toptions.drawError = L.Util.extend({}, this.options.drawError, options.drawError);\n\t\t}\n\n\t\tthis._latlngs = latlngs;\n\n\t\tL.setOptions(this, options);\n\t},\n\n\t// Compatibility method to normalize Poly* objects\n\t// between 0.7.x and 1.0+\n\t_defaultShape: function () {\n\t\tif (!L.Polyline._flat) {\n\t\t\treturn this._latlngs;\n\t\t}\n\t\treturn L.Polyline._flat(this._latlngs) ? this._latlngs : this._latlngs[0];\n\t},\n\n\t// @method addHooks(): void\n\t// Add listener hooks to this handler.\n\taddHooks: function () {\n\t\tvar poly = this._poly;\n\t\tvar path = poly._path;\n\n\t\tif (!(poly instanceof L.Polygon)) {\n\t\t\tpoly.options.fill = false;\n\t\t\tif (poly.options.editing) {\n\t\t\t\tpoly.options.editing.fill = false;\n\t\t\t}\n\t\t}\n\n\t\tif (path) {\n\t\t\tif (poly.options.editing.className) {\n\t\t\t\tif (poly.options.original.className) {\n\t\t\t\t\tpoly.options.original.className.split(' ').forEach(function (className) {\n\t\t\t\t\t\tL.DomUtil.removeClass(path, className);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tpoly.options.editing.className.split(' ').forEach(function (className) {\n\t\t\t\t\tL.DomUtil.addClass(path, className);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tpoly.setStyle(poly.options.editing);\n\n\t\tif (this._poly._map) {\n\n\t\t\tthis._map = this._poly._map; // Set map\n\n\t\t\tif (!this._markerGroup) {\n\t\t\t\tthis._initMarkers();\n\t\t\t}\n\t\t\tthis._poly._map.addLayer(this._markerGroup);\n\t\t}\n\t},\n\n\t// @method removeHooks(): void\n\t// Remove listener hooks from this handler.\n\tremoveHooks: function () {\n\t\tvar poly = this._poly;\n\t\tvar path = poly._path;\n\n\t\tif (path) {\n\t\t\tif (poly.options.editing.className) {\n\t\t\t\tpoly.options.editing.className.split(' ').forEach(function (className) {\n\t\t\t\t\tL.DomUtil.removeClass(path, className);\n\t\t\t\t});\n\t\t\t\tif (poly.options.original.className) {\n\t\t\t\t\tpoly.options.original.className.split(' ').forEach(function (className) {\n\t\t\t\t\t\tL.DomUtil.addClass(path, className);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tpoly.setStyle(poly.options.original);\n\n\t\tif (poly._map) {\n\t\t\tpoly._map.removeLayer(this._markerGroup);\n\t\t\tdelete this._markerGroup;\n\t\t\tdelete this._markers;\n\t\t}\n\t},\n\n\t// @method updateMarkers(): void\n\t// Clear markers and update their location\n\tupdateMarkers: function () {\n\t\tthis._markerGroup.clearLayers();\n\t\tthis._initMarkers();\n\t},\n\n\t_initMarkers: function () {\n\t\tif (!this._markerGroup) {\n\t\t\tthis._markerGroup = new L.LayerGroup();\n\t\t}\n\t\tthis._markers = [];\n\n\t\tvar latlngs = this._defaultShape(),\n\t\t\ti, j, len, marker;\n\n\t\tfor (i = 0, len = latlngs.length; i < len; i++) {\n\n\t\t\tmarker = this._createMarker(latlngs[i], i);\n\t\t\tmarker.on('click', this._onMarkerClick, this);\n\t\t\tmarker.on('contextmenu', this._onContextMenu, this);\n\t\t\tthis._markers.push(marker);\n\t\t}\n\n\t\tvar markerLeft, markerRight;\n\n\t\tfor (i = 0, j = len - 1; i < len; j = i++) {\n\t\t\tif (i === 0 && !(L.Polygon && (this._poly instanceof L.Polygon))) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tmarkerLeft = this._markers[j];\n\t\t\tmarkerRight = this._markers[i];\n\n\t\t\tthis._createMiddleMarker(markerLeft, markerRight);\n\t\t\tthis._updatePrevNext(markerLeft, markerRight);\n\t\t}\n\t},\n\n\t_createMarker: function (latlng, index) {\n\t\t// Extending L.Marker in TouchEvents.js to include touch.\n\t\tvar marker = new L.Marker.Touch(latlng, {\n\t\t\tdraggable: true,\n\t\t\ticon: this.options.icon,\n\t\t});\n\n\t\tmarker._origLatLng = latlng;\n\t\tmarker._index = index;\n\n\t\tmarker\n\t\t\t.on('dragstart', this._onMarkerDragStart, this)\n\t\t\t.on('drag', this._onMarkerDrag, this)\n\t\t\t.on('dragend', this._fireEdit, this)\n\t\t\t.on('touchmove', this._onTouchMove, this)\n\t\t\t.on('touchend', this._fireEdit, this)\n\t\t\t.on('MSPointerMove', this._onTouchMove, this)\n\t\t\t.on('MSPointerUp', this._fireEdit, this);\n\n\t\tthis._markerGroup.addLayer(marker);\n\n\t\treturn marker;\n\t},\n\n\t_onMarkerDragStart: function () {\n\t\tthis._poly.fire('editstart');\n\t},\n\n\t_spliceLatLngs: function () {\n\t\tvar latlngs = this._defaultShape();\n\t\tvar removed = [].splice.apply(latlngs, arguments);\n\t\tthis._poly._convertLatLngs(latlngs, true);\n\t\tthis._poly.redraw();\n\t\treturn removed;\n\t},\n\n\t_removeMarker: function (marker) {\n\t\tvar i = marker._index;\n\n\t\tthis._markerGroup.removeLayer(marker);\n\t\tthis._markers.splice(i, 1);\n\t\tthis._spliceLatLngs(i, 1);\n\t\tthis._updateIndexes(i, -1);\n\n\t\tmarker\n\t\t\t.off('dragstart', this._onMarkerDragStart, this)\n\t\t\t.off('drag', this._onMarkerDrag, this)\n\t\t\t.off('dragend', this._fireEdit, this)\n\t\t\t.off('touchmove', this._onMarkerDrag, this)\n\t\t\t.off('touchend', this._fireEdit, this)\n\t\t\t.off('click', this._onMarkerClick, this)\n\t\t\t.off('MSPointerMove', this._onTouchMove, this)\n\t\t\t.off('MSPointerUp', this._fireEdit, this);\n\t},\n\n\t_fireEdit: function () {\n\t\tthis._poly.edited = true;\n\t\tthis._poly.fire('edit');\n\t\tthis._poly._map.fire(L.Draw.Event.EDITVERTEX, {layers: this._markerGroup, poly: this._poly});\n\t},\n\n\t_onMarkerDrag: function (e) {\n\t\tvar marker = e.target;\n\t\tvar poly = this._poly;\n\n\t\tL.extend(marker._origLatLng, marker._latlng);\n\n\t\tif (marker._middleLeft) {\n\t\t\tmarker._middleLeft.setLatLng(this._getMiddleLatLng(marker._prev, marker));\n\t\t}\n\t\tif (marker._middleRight) {\n\t\t\tmarker._middleRight.setLatLng(this._getMiddleLatLng(marker, marker._next));\n\t\t}\n\n\t\tif (poly.options.poly) {\n\t\t\tvar tooltip = poly._map._editTooltip; // Access the tooltip\n\n\t\t\t// If we don't allow intersections and the polygon intersects\n\t\t\tif (!poly.options.poly.allowIntersection && poly.intersects()) {\n\n\t\t\t\tvar originalColor = poly.options.color;\n\t\t\t\tpoly.setStyle({color: this.options.drawError.color});\n\n\t\t\t\t// Manually trigger 'dragend' behavior on marker we are about to remove\n\t\t\t\t// WORKAROUND: introduced in 1.0.0-rc2, may be related to #4484\n\t\t\t\tif (L.version.indexOf('0.7') !== 0) {\n\t\t\t\t\tmarker.dragging._draggable._onUp(e);\n\t\t\t\t}\n\t\t\t\tthis._onMarkerClick(e); // Remove violating marker\n\t\t\t\t// FIXME: Reset the marker to it's original position (instead of remove)\n\n\t\t\t\tif (tooltip) {\n\t\t\t\t\ttooltip.updateContent({\n\t\t\t\t\t\ttext: L.drawLocal.draw.handlers.polyline.error\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Reset everything back to normal after a second\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tpoly.setStyle({color: originalColor});\n\t\t\t\t\tif (tooltip) {\n\t\t\t\t\t\ttooltip.updateContent({\n\t\t\t\t\t\t\ttext: L.drawLocal.edit.handlers.edit.tooltip.text,\n\t\t\t\t\t\t\tsubtext: L.drawLocal.edit.handlers.edit.tooltip.subtext\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}, 1000);\n\t\t\t}\n\t\t}\n\t\t//refresh the bounds when draging\n\t\tthis._poly._bounds._southWest = L.latLng(Infinity, Infinity);\n\t\tthis._poly._bounds._northEast = L.latLng(-Infinity, -Infinity);\n\t\tvar latlngs = this._poly.getLatLngs();\n\t\tthis._poly._convertLatLngs(latlngs, true);\n\t\tthis._poly.redraw();\n\t\tthis._poly.fire('editdrag');\n\t},\n\n\t_onMarkerClick: function (e) {\n\n\t\tvar minPoints = L.Polygon && (this._poly instanceof L.Polygon) ? 4 : 3,\n\t\t\tmarker = e.target;\n\n\t\t// If removing this point would create an invalid polyline/polygon don't remove\n\t\tif (this._defaultShape().length < minPoints) {\n\t\t\treturn;\n\t\t}\n\n\t\t// remove the marker\n\t\tthis._removeMarker(marker);\n\n\t\t// update prev/next links of adjacent markers\n\t\tthis._updatePrevNext(marker._prev, marker._next);\n\n\t\t// remove ghost markers near the removed marker\n\t\tif (marker._middleLeft) {\n\t\t\tthis._markerGroup.removeLayer(marker._middleLeft);\n\t\t}\n\t\tif (marker._middleRight) {\n\t\t\tthis._markerGroup.removeLayer(marker._middleRight);\n\t\t}\n\n\t\t// create a ghost marker in place of the removed one\n\t\tif (marker._prev && marker._next) {\n\t\t\tthis._createMiddleMarker(marker._prev, marker._next);\n\n\t\t} else if (!marker._prev) {\n\t\t\tmarker._next._middleLeft = null;\n\n\t\t} else if (!marker._next) {\n\t\t\tmarker._prev._middleRight = null;\n\t\t}\n\n\t\tthis._fireEdit();\n\t},\n\n\t_onContextMenu: function (e) {\n\t\tvar marker = e.target;\n\t\tvar poly = this._poly;\n\t\tthis._poly._map.fire(L.Draw.Event.MARKERCONTEXT, {marker: marker, layers: this._markerGroup, poly: this._poly});\n\t\tL.DomEvent.stopPropagation;\n\t},\n\n\t_onTouchMove: function (e) {\n\n\t\tvar layerPoint = this._map.mouseEventToLayerPoint(e.originalEvent.touches[0]),\n\t\t\tlatlng = this._map.layerPointToLatLng(layerPoint),\n\t\t\tmarker = e.target;\n\n\t\tL.extend(marker._origLatLng, latlng);\n\n\t\tif (marker._middleLeft) {\n\t\t\tmarker._middleLeft.setLatLng(this._getMiddleLatLng(marker._prev, marker));\n\t\t}\n\t\tif (marker._middleRight) {\n\t\t\tmarker._middleRight.setLatLng(this._getMiddleLatLng(marker, marker._next));\n\t\t}\n\n\t\tthis._poly.redraw();\n\t\tthis.updateMarkers();\n\t},\n\n\t_updateIndexes: function (index, delta) {\n\t\tthis._markerGroup.eachLayer(function (marker) {\n\t\t\tif (marker._index > index) {\n\t\t\t\tmarker._index += delta;\n\t\t\t}\n\t\t});\n\t},\n\n\t_createMiddleMarker: function (marker1, marker2) {\n\t\tvar latlng = this._getMiddleLatLng(marker1, marker2),\n\t\t\tmarker = this._createMarker(latlng),\n\t\t\tonClick,\n\t\t\tonDragStart,\n\t\t\tonDragEnd;\n\n\t\tmarker.setOpacity(0.6);\n\n\t\tmarker1._middleRight = marker2._middleLeft = marker;\n\n\t\tonDragStart = function () {\n\t\t\tmarker.off('touchmove', onDragStart, this);\n\t\t\tvar i = marker2._index;\n\n\t\t\tmarker._index = i;\n\n\t\t\tmarker\n\t\t\t\t.off('click', onClick, this)\n\t\t\t\t.on('click', this._onMarkerClick, this);\n\n\t\t\tlatlng.lat = marker.getLatLng().lat;\n\t\t\tlatlng.lng = marker.getLatLng().lng;\n\t\t\tthis._spliceLatLngs(i, 0, latlng);\n\t\t\tthis._markers.splice(i, 0, marker);\n\n\t\t\tmarker.setOpacity(1);\n\n\t\t\tthis._updateIndexes(i, 1);\n\t\t\tmarker2._index++;\n\t\t\tthis._updatePrevNext(marker1, marker);\n\t\t\tthis._updatePrevNext(marker, marker2);\n\n\t\t\tthis._poly.fire('editstart');\n\t\t};\n\n\t\tonDragEnd = function () {\n\t\t\tmarker.off('dragstart', onDragStart, this);\n\t\t\tmarker.off('dragend', onDragEnd, this);\n\t\t\tmarker.off('touchmove', onDragStart, this);\n\n\t\t\tthis._createMiddleMarker(marker1, marker);\n\t\t\tthis._createMiddleMarker(marker, marker2);\n\t\t};\n\n\t\tonClick = function () {\n\t\t\tonDragStart.call(this);\n\t\t\tonDragEnd.call(this);\n\t\t\tthis._fireEdit();\n\t\t};\n\n\t\tmarker\n\t\t\t.on('click', onClick, this)\n\t\t\t.on('dragstart', onDragStart, this)\n\t\t\t.on('dragend', onDragEnd, this)\n\t\t\t.on('touchmove', onDragStart, this);\n\n\t\tthis._markerGroup.addLayer(marker);\n\t},\n\n\t_updatePrevNext: function (marker1, marker2) {\n\t\tif (marker1) {\n\t\t\tmarker1._next = marker2;\n\t\t}\n\t\tif (marker2) {\n\t\t\tmarker2._prev = marker1;\n\t\t}\n\t},\n\n\t_getMiddleLatLng: function (marker1, marker2) {\n\t\tvar map = this._poly._map,\n\t\t\tp1 = map.project(marker1.getLatLng()),\n\t\t\tp2 = map.project(marker2.getLatLng());\n\n\t\treturn map.unproject(p1._add(p2)._divideBy(2));\n\t}\n});\n\nL.Polyline.addInitHook(function () {\n\n\t// Check to see if handler has already been initialized. This is to support versions of Leaflet that still have L.Handler.PolyEdit\n\tif (this.editing) {\n\t\treturn;\n\t}\n\n\tif (L.Edit.Poly) {\n\n\t\tthis.editing = new L.Edit.Poly(this);\n\n\t\tif (this.options.editable) {\n\t\t\tthis.editing.enable();\n\t\t}\n\t}\n\n\tthis.on('add', function () {\n\t\tif (this.editing && this.editing.enabled()) {\n\t\t\tthis.editing.addHooks();\n\t\t}\n\t});\n\n\tthis.on('remove', function () {\n\t\tif (this.editing && this.editing.enabled()) {\n\t\t\tthis.editing.removeHooks();\n\t\t}\n\t});\n});\n"]}